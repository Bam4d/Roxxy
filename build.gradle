apply plugin: 'cpp'

def cefBinaryPath = file("../cef_binary_linux64").absolutePath

def cefResources = copySpec {
    from(cefBinaryPath+"/Resources") {
        include "*"
    }
    from(cefBinaryPath+"/Release") {
        include "libcef.so"
        include "*.bin"
    }
}

task copyCefResources << {
    ['build/exe/roxxy/debug', 'build/exe/roxxy/release'].each { dest ->
        copy {
            with cefResources
            into dest
        }
    }

}

model {
    buildTypes {
        debug
        release
    }

    components {
        roxxy(NativeExecutableSpec) {
            sources {
                cpp {
                    source {
                        srcDir "src"
                        include "**/*.cc"
                    }
                }
            }
        }
    }

    binaries {
        all {
            // Linker and compiler arguments
            if (toolChain in Gcc) {
                cppCompiler.args "-D__GXX_EXPERIMENTAL_CXX0X__", "-D__cplusplus=201103L", "-I"+cefBinaryPath, "-O2", "-g3", "-Wall", "-c", "-fmessage-length=0", "-std=c++11", "-MMD", "-MP"
                linker.args "-lglog", "-ldouble-conversion", "-lpthread", "-lgflags", "-lproxygenhttpserver", "-lfolly", cefBinaryPath+"/Release/libcef.so", cefBinaryPath+"/libcef_dll/libcef_dll_wrapper.a"
            }  
            build.finalizedBy copyCefResources
        }
    }
}



    
